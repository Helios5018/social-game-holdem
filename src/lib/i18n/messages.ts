export type Language = "zh" | "en";

type Dictionary = Record<string, string>;

const en: Dictionary = {
  "language.switchAria": "Language switch",

  "lobby.title": "Social Hold'em",
  "lobby.subtitle": "Create a room for your host console or join from a phone.",
  "lobby.hostPanel": "Create Room (Host)",
  "lobby.hostName": "Host Name",
  "lobby.smallBlind": "Small Blind",
  "lobby.bigBlind": "Big Blind",
  "lobby.createButton": "Create Host Room",
  "lobby.playerPanel": "Join Room (Player)",
  "lobby.roomCode": "Room Code",
  "lobby.playerName": "Player Name",
  "lobby.joinButton": "Join as Player",
  "lobby.createFailed": "Failed to create room",
  "lobby.joinFailed": "Failed to join room",
  "lobby.tutorialTitle": "Texas Hold'em Tutorial",
  "lobby.tutorialSubtitle": "Learn the basic rules in 5 minutes before your first game.",
  "lobby.tutorialFallback": "If the player does not load, open video in Bilibili",

  "host.title": "Host Console · {roomCode}",
  "host.tokenMissing": "Host token is missing in this browser. Create the room from lobby first.",
  "host.loading": "Loading room...",
  "host.status": "Status: {status} · Hand #{handNo} · Street: {street}",
  "host.blinds": "Blinds: {smallBlind}/{bigBlind}",
  "host.startHand": "Start Hand",
  "host.startHandFailed": "Failed to start hand",
  "host.startHandInvalidStack": "All seated players must have chips before starting a hand.",
  "host.lastResults": "Last Results",
  "host.actionLog": "Action Log",
  "host.resultLine": "{reason}: {amount} chips to {winners}",
  "host.recharge.title": "Chip Recharge",
  "host.recharge.amount": "Recharge Amount",
  "host.recharge.button": "Recharge",
  "host.recharge.disabledInHand": "Recharge is only available before a hand starts.",
  "host.recharge.amountRequired": "Recharge amount must be greater than 0.",
  "host.recharge.collapsedHint": "Collapsed by default. Expand to manage seated players.",
  "host.recharge.success": "{player} +{amount} chips",
  "host.recharge.failed": "Recharge failed",
  "host.recharge.empty": "No seated players yet.",
  "host.ai.title": "AI Players",
  "host.ai.collapsedHint": "Collapsed by default. Expand to add and manage AI players.",
  "host.ai.name": "Name",
  "host.ai.personality": "Personality",
  "host.ai.customPersonality": "Custom Persona",
  "host.ai.initialChips": "Initial Chips",
  "host.ai.addButton": "Add AI",
  "host.ai.updateButton": "Save",
  "host.ai.removeButton": "Remove",
  "host.ai.empty": "No AI players yet.",
  "host.ai.personality.aggressive": "Aggressive",
  "host.ai.personality.conservative": "Conservative",
  "host.ai.personality.balanced": "Balanced",
  "host.ai.personality.custom": "Custom",
  "host.ai.disabledInHand": "AI management is only available before a hand starts.",
  "host.ai.customRequired": "Custom persona text is required.",
  "host.ai.chipsRequired": "Initial chips must be greater than 0.",
  "host.ai.addSuccess": "AI player added",
  "host.ai.updateSuccess": "AI personality updated",
  "host.ai.removeSuccess": "AI player removed",
  "host.ai.loadFailed": "Failed to load AI players",
  "host.ai.addFailed": "Failed to add AI player",
  "host.ai.updateFailed": "Failed to update AI personality",
  "host.ai.removeFailed": "Failed to remove AI player",
  "host.actionLog.collapsedHint": "Collapsed by default. Expand to view action timeline.",
  "host.section.expand": "Expand",
  "host.section.collapse": "Collapse",
  "host.systemLog.title": "System Logs",
  "host.systemLog.level": "{level}",
  "host.systemLog.scope": "{scope}",
  "host.systemLog.empty": "No logs yet.",
  "host.systemLog.autoScroll": "Auto-scroll",
  "host.systemLog.showDebug": "Show DEBUG",
  "host.systemLog.expand": "Expand",
  "host.systemLog.collapse": "Collapse",
  "host.systemLog.collapsedHint": "Collapsed by default. Expand to view latest logs.",

  "player.title": "Player View · {roomCode}",
  "player.tokenMissing": "Player token missing. Join this room from the lobby first.",
  "player.loading": "Loading room state...",
  "player.header": "Hand #{handNo} · Street: {street}",
  "player.nickname": "Nickname: {name}",
  "player.notSeated": "Not Seated",
  "player.takeSeat": "Take a seat",
  "player.rechargeHint": "After taking a seat, wait for host recharge before the next hand.",
  "player.seat": "Seat {seat}",
  "player.takeSeatFailed": "Failed to take seat",
  "player.yourHand": "Your hand",
  "player.stackLine": "Stack: {stack} · {state}",
  "player.yourTurn": "Your turn",
  "player.waiting": "Waiting",
  "player.actions": "Actions",
  "player.fold": "Fold",
  "player.check": "Check",
  "player.call": "Call {toCall}",
  "player.bet": "Bet",
  "player.raise": "Raise",
  "player.allIn": "All-in",
  "player.actionFailed": "Action failed",

  "table.dealer": "D",
  "table.smallBlind": "SB",
  "table.bigBlind": "BB",
  "table.folded": "Folded",
  "table.allIn": "All-in",
  "table.acting": "Acting",
  "table.waitingReconnect": "Waiting reconnect",
  "table.inHand": "In hand",
  "table.waiting": "Waiting",
  "table.offline": "Offline",
  "table.chips": "{chips} chips",
  "table.betStreet": "Street: {amount}",
  "table.betHand": "Hand total: {amount}",

  "pot.total": "Total Pot",
  "pot.main": "Main Pot",
  "pot.side": "Side Pot #{index}",
  "pot.eligible": "Contested by {count} players",
  "pot.contestedBy": "Contested by {players}",
  "pot.none": "None",
  "pot.chipValue": "{value} chip",
  "pot.expand": "Expand",
  "pot.collapse": "Collapse",
  "pot.summaryMainOnly": "Main Pot: {main}",
  "pot.summaryWithSide": "Main Pot: {main} · Side Pots: {sideCount}",
  "showdown.title": "Showdown · Hand #{handNo}",
  "showdown.board": "Board",
  "showdown.hand": "Hand",
  "showdown.winner": "Winner",
};

const zh: Dictionary = {
  "language.switchAria": "语言切换",

  "lobby.title": "社交德州扑克",
  "lobby.subtitle": "创建主持房间，或在手机端加入牌桌。",
  "lobby.hostPanel": "创建房间（主持端）",
  "lobby.hostName": "主持昵称",
  "lobby.smallBlind": "小盲注",
  "lobby.bigBlind": "大盲注",
  "lobby.createButton": "创建主持房间",
  "lobby.playerPanel": "加入房间（玩家端）",
  "lobby.roomCode": "房间码",
  "lobby.playerName": "玩家昵称",
  "lobby.joinButton": "作为玩家加入",
  "lobby.createFailed": "创建房间失败",
  "lobby.joinFailed": "加入房间失败",
  "lobby.tutorialTitle": "德州扑克教程视频",
  "lobby.tutorialSubtitle": "开局前先看 5 分钟，快速掌握基础规则。",
  "lobby.tutorialFallback": "若播放器未加载，可在 B 站打开视频",

  "host.title": "主持控制台 · {roomCode}",
  "host.tokenMissing": "当前浏览器缺少主持令牌，请先在大厅创建房间。",
  "host.loading": "正在加载房间...",
  "host.status": "状态：{status} · 第 {handNo} 手 · 阶段：{street}",
  "host.blinds": "盲注：{smallBlind}/{bigBlind}",
  "host.startHand": "开始一手",
  "host.startHandFailed": "开局失败",
  "host.startHandInvalidStack": "开局前所有已入座玩家都必须有筹码。",
  "host.lastResults": "最近结算",
  "host.actionLog": "操作日志",
  "host.resultLine": "{reason}：{amount} 筹码给 {winners}",
  "host.recharge.title": "筹码充值",
  "host.recharge.amount": "充值数量",
  "host.recharge.button": "充值",
  "host.recharge.disabledInHand": "仅可在未开局时进行充值。",
  "host.recharge.amountRequired": "充值数量必须大于 0。",
  "host.recharge.collapsedHint": "默认收起，展开后可管理已入座玩家充值。",
  "host.recharge.success": "{player} +{amount} 筹码",
  "host.recharge.failed": "充值失败",
  "host.recharge.empty": "暂无已入座玩家。",
  "host.ai.title": "AI 玩家",
  "host.ai.collapsedHint": "默认收起，展开后可添加和管理 AI 玩家。",
  "host.ai.name": "名称",
  "host.ai.personality": "性格",
  "host.ai.customPersonality": "自定义人设",
  "host.ai.initialChips": "初始筹码",
  "host.ai.addButton": "添加 AI",
  "host.ai.updateButton": "保存",
  "host.ai.removeButton": "移除",
  "host.ai.empty": "暂无 AI 玩家。",
  "host.ai.personality.aggressive": "激进",
  "host.ai.personality.conservative": "保守",
  "host.ai.personality.balanced": "均衡",
  "host.ai.personality.custom": "自定义",
  "host.ai.disabledInHand": "仅可在未开局时管理 AI 玩家。",
  "host.ai.customRequired": "请输入自定义人设文本。",
  "host.ai.chipsRequired": "初始筹码必须大于 0。",
  "host.ai.addSuccess": "AI 玩家已添加",
  "host.ai.updateSuccess": "AI 人设已更新",
  "host.ai.removeSuccess": "AI 玩家已移除",
  "host.ai.loadFailed": "加载 AI 列表失败",
  "host.ai.addFailed": "添加 AI 玩家失败",
  "host.ai.updateFailed": "更新 AI 人设失败",
  "host.ai.removeFailed": "移除 AI 玩家失败",
  "host.actionLog.collapsedHint": "默认收起，展开后可查看完整操作时间线。",
  "host.section.expand": "展开",
  "host.section.collapse": "收起",
  "host.systemLog.title": "系统日志",
  "host.systemLog.level": "{level}",
  "host.systemLog.scope": "{scope}",
  "host.systemLog.empty": "暂无系统日志。",
  "host.systemLog.autoScroll": "自动滚动",
  "host.systemLog.showDebug": "显示 DEBUG",
  "host.systemLog.expand": "展开",
  "host.systemLog.collapse": "收起",
  "host.systemLog.collapsedHint": "默认收起，点击展开后查看最新系统日志。",

  "player.title": "玩家视图 · {roomCode}",
  "player.tokenMissing": "缺少玩家令牌，请先从大厅加入该房间。",
  "player.loading": "正在加载牌桌状态...",
  "player.header": "第 {handNo} 手 · 阶段：{street}",
  "player.nickname": "昵称：{name}",
  "player.notSeated": "未入座",
  "player.takeSeat": "选择座位",
  "player.rechargeHint": "入座后请等待主持端充值，再开始下一手。",
  "player.seat": "座位 {seat}",
  "player.takeSeatFailed": "入座失败",
  "player.yourHand": "你的手牌",
  "player.stackLine": "筹码：{stack} · {state}",
  "player.yourTurn": "轮到你行动",
  "player.waiting": "等待中",
  "player.actions": "行动区",
  "player.fold": "弃牌",
  "player.check": "过牌",
  "player.call": "跟注 {toCall}",
  "player.bet": "下注",
  "player.raise": "加注",
  "player.allIn": "全下",
  "player.actionFailed": "执行动作失败",

  "table.dealer": "庄",
  "table.smallBlind": "小盲",
  "table.bigBlind": "大盲",
  "table.folded": "已弃牌",
  "table.allIn": "全下",
  "table.acting": "行动中",
  "table.waitingReconnect": "等待重连",
  "table.inHand": "在牌局中",
  "table.waiting": "等待中",
  "table.offline": "离线",
  "table.chips": "{chips} 筹码",
  "table.betStreet": "本阶段：{amount}",
  "table.betHand": "本手累计：{amount}",

  "pot.total": "总底池",
  "pot.main": "主池",
  "pot.side": "边池 #{index}",
  "pot.eligible": "{count} 人可争夺",
  "pot.contestedBy": "可争夺：{players}",
  "pot.none": "无",
  "pot.chipValue": "{value} 面值筹码",
  "pot.expand": "展开",
  "pot.collapse": "收起",
  "pot.summaryMainOnly": "主池：{main}",
  "pot.summaryWithSide": "主池：{main} · 边池：{sideCount}",
  "showdown.title": "摊牌详情 · 第 {handNo} 手",
  "showdown.board": "公共牌",
  "showdown.hand": "牌型",
  "showdown.winner": "赢家",
};

const dictionaries: Record<Language, Dictionary> = { zh, en };

export function resolveLanguage(input: string | null | undefined): Language {
  return input === "en" ? "en" : "zh";
}

export function detectLanguage(languages: readonly string[]): Language {
  for (const item of languages) {
    const normalized = item.toLowerCase();
    if (normalized.startsWith("en")) {
      return "en";
    }
    if (normalized.startsWith("zh")) {
      return "zh";
    }
  }

  return "zh";
}

export function translate(
  language: Language,
  key: string,
  vars?: Record<string, string | number>,
): string {
  const table = dictionaries[language] ?? dictionaries.zh;
  const template = table[key] ?? dictionaries.en[key] ?? key;
  if (!vars) {
    return template;
  }

  return template.replace(/\{(\w+)\}/g, (_, token: string) => {
    const value = vars[token];
    return value == null ? "" : String(value);
  });
}
